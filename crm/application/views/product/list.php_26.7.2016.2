<?php $this->load->view('header');?>
<?php $this->load->view('left');
//print_r($companyIDName);
?>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="https://code.jquery.com/resources/demos/style.css">
  <style>
  .custom-combobox {
    position: relative;
    display: inline-block;
  }
  .custom-combobox-toggle {
    position: absolute;
    top: 0;
    bottom: 0;
    margin-left: -1px;
    padding: 0;
  }
  .custom-combobox-input {
    margin: 0;
    padding: 5px 10px;
  }
  </style>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
  <script>
  $( function() {
    $.widget( "custom.combobox", {
      _create: function() {
        this.wrapper = $( "<span>" )
          .addClass( "custom-combobox" )
          .insertAfter( this.element );
 
        this.element.hide();
        this._createAutocomplete();
        this._createShowAllButton();
      },
 
      _createAutocomplete: function() {
        var selected = this.element.children( ":selected" ),
          value = selected.val() ? selected.text() : "";
 
        this.input = $( "<input>" )
          .appendTo( this.wrapper )
          .val( value )
          .attr( "title", "" )
          .addClass( "custom-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-left" )
          .autocomplete({
            delay: 0,
            minLength: 0,
            source: $.proxy( this, "_source" )
          })
          .tooltip({
            classes: {
              "ui-tooltip": "ui-state-highlight"
            }
          });
 
        this._on( this.input, {
          autocompleteselect: function( event, ui ) {
            ui.item.option.selected = true;
            this._trigger( "select", event, {
              item: ui.item.option
            });
          },
 
          autocompletechange: "_removeIfInvalid"
        });
      },
 
      _createShowAllButton: function() {
        var input = this.input,
          wasOpen = false;
 
        $( "<a>" )
          .attr( "tabIndex", -1 )
          .attr( "title", "Show All Items" )
          .tooltip()
          .appendTo( this.wrapper )
          .button({
            icons: {
              primary: "ui-icon-triangle-1-s"
            },
            text: false
          })
          .removeClass( "ui-corner-all" )
          .addClass( "custom-combobox-toggle ui-corner-right" )
          .on( "mousedown", function() {
            wasOpen = input.autocomplete( "widget" ).is( ":visible" );
          })
          .on( "click", function() {
            input.trigger( "focus" );
 
            // Close if already visible
            if ( wasOpen ) {
              return;
            }
 
            // Pass empty string as value to search for, displaying all results
            input.autocomplete( "search", "" );
          });
      },
 
      _source: function( request, response ) {
        var matcher = new RegExp( $.ui.autocomplete.escapeRegex(request.term), "i" );
        response( this.element.children( "option" ).map(function() {
          var text = $( this ).text();
          if ( this.value && ( !request.term || matcher.test(text) ) )
            return {
              label: text,
              value: text,
              option: this
            };
        }) );
      },
 
     
 
      _destroy: function() {
        this.wrapper.remove();
        this.element.show();
      }
    });
 
    $( "#brandName" ).combobox();
    $( "#genericName" ).combobox();
    
  } );
  </script>
<div class="mainpanel">
                    
	<div class="contentpanel contentpanel-mediamanager"> 
			<div class="clearfix">
			<div class="pull-right"><a href="<?php echo site_url($this->controllerFile.'/add');?>" class="btn btn-primary" data-toggle="modal" ><span class="glyphicon glyphicon-plus"></span> Add </a></div>
			</div>
			</br>
	
	<?php
	//print_r($ResultProduct);
      if($ResultProduct->num_rows() == 0){
	   		echo '<div class="alert alert-warning no-radius no-margin padding-sm" role="alert"><strong><i class="fa fa-warning"></i> Warning:</strong> No Records Found.</div>';
	  } 
		
		 
			
	 ?>
<!------------------------search section------------------------>	

			
			<form class="form-inline" role="form" name="frmSearch" id="frmSearch" action="<?php echo base_url().$this->controllerFile; ?>" method="POST" >
			<div class="well">
			<input type="hidden" name="hdnOrderBy" id="hdnOrderBy" value="<?php echo $order_by; ?>"/>
			<input type="hidden" name="hdnOrderByFld" id="hdnOrderByFld" value="<?php echo $order_by_fld; ?>"/>			
			<input type="hidden" name="search" value="search"/>
			
			
			<div class="form-group">			
				<select name="category" id="category" class="form-control">
					<option value="">Select Category</option>	
					<?php foreach($resultCategory->result() as $val){?>
						 <option <?php if($category==$val->id){ ?> selected <?php } ?>value="<?php echo $val->id;?>"><?php echo $val->name;?></option>
					<?php } ?>
				</select>
            </div>			
			<div class="form-group ui-widget">			
				<select name="brandName" id="brandName" class="form-control">
					<option value="">Select Brand Name</option>	
					<?php foreach($resultBrand->result() as $val){?>
						 <option <?php if($brandName==$val->brandName){ ?> selected <?php } ?>value="<?php echo $val->brandName;?>"><?php echo $val->brandName;?></option>
					<?php } ?>
				</select>
            </div>			
			<div class="form-group ui-widget">			
				<select name="genericName" id="genericName" class="form-control">
					<option value="">Select Generic Name</option>	
					<?php foreach($resultGeneric->result() as $val){?>
						 <option <?php if($genericName==$val->genericName){ ?> selected <?php } ?>value="<?php echo $val->genericName;?>"><?php echo $val->genericName;?></option>
					<?php } ?>
				</select>
            </div>
			
			
			
			<div class="form-group">
			<button type="submit" class="btn btn-primary"><span class="glyphicon glyphicon-search"></span> Search</button>
			</div>
			<div class="form-group">
			<!--a href="<?php echo base_url();?>gateway" style="font-weight:bold">View All</a-->
			<a href="<?php echo base_url().$this->controllerFile; ?>" class="btn btn-primary"><i class="fa fa-align-justify"></i> Clear</a>
			</div>
			<br/>
			<br/>
			<div class="form-group">
			<a href="<?php echo base_url().$this->controllerFile;?>/add_all_product" class="btn btn-primary"><span class="glyphicon glyphicon-plus"></span>Add All Products</a>
			</div>
			</div>
			
			
<!-------------------------------------------------------------->
			<?php
			if($ResultProduct->num_rows() > 0){	?>		
            <div class="table-responsive">
            
            <table class="table">
              <thead>
                <tr>
					<th><a style="text-decoration:none;font-size:12px;font-weight:<?=($order_by_fld=='category')?'bold':'normal'?>;" href="javascript: hdnSort('category','<?php echo $order_by; ?>');">Category</a></th>
					<th><a style="text-decoration:none;font-size:12px;font-weight:<?=($order_by_fld=='brandName')?'bold':'normal'?>;" href="javascript: hdnSort('brandName','<?php echo $order_by; ?>');">Brand Name</a></th>
					
					<th><a style="text-decoration:none;font-size:12px;font-weight:<?=($order_by_fld=='genericName')?'bold':'normal'?>;" href="javascript: hdnSort('genericName','<?php echo $order_by; ?>');">Generic Name</a></th>
					<th><a style="text-decoration:none;font-size:12px;font-weight:<?=($order_by_fld=='dosage')?'bold':'normal'?>;" href="javascript: hdnSort('dosage','<?php echo $order_by; ?>');">Dosage</a></th>
					<th>
					<a style="text-decoration:none;font-size:12px;font-weight:<?=($order_by_fld=='pack')?'bold':'normal'?>;" href="javascript: hdnSort('pack','<?php echo $order_by; ?>');">Pack</a>
					</th>
					<th><a style="text-decoration:none;font-size:12px;font-weight:<?=($order_by_fld=='form')?'bold':'normal'?>;" href="javascript: hdnSort('form','<?php echo $order_by; ?>');">Form</a>
					</th>
					<th><a style="text-decoration:none;font-size:12px;font-weight:<?=($order_by_fld=='cost')?'bold':'normal'?>;" href="javascript: hdnSort('cost','<?php echo $order_by; ?>');">Cost</a></th>
					<th><a style="text-decoration:none;font-size:12px;font-weight:<?=($order_by_fld=='manufacturer')?'bold':'normal'?>;" href="javascript: hdnSort('manufacturer','<?php echo $order_by; ?>');">Manufacturer</a></th>					
					<th colspan="2">
					<input type="button" name="Check_All" value="Check All" onClick="Check(document.frmSearch.product_id)" />
					<a href="#" class="btn btn-primary" data-toggle="modal" onclick="addSelected();" ><span class="glyphicon glyphicon-plus"></span> Add Selected</a></th>
                </tr>
              </thead>
              <tbody>
                
              <?php foreach ($ResultProduct->result() as $row){   ?> 
                <tr>
					
					<td><?php echo $this->db->query("select name from t_category where id='".$row->category."'")->row()->name; ?></td>				
					<td><?php echo $row->brandName; ?></td>					
					<td><?php echo $row->genericName; ?></td>
					<td><?php echo $row->dosage; ?></td>
					<td><?php echo $row->pack; ?></td>
					<td><?php echo $row->form; ?></td>
					<td><?php echo sprintf('%0.2f',$row->cost); ?></td>
					<td><?php echo $row->manufacturer; ?></td>
					
					<td ><input type="checkbox" name="product_id" value="<?php echo $row->id;?>"/></td>
					<td><a href="<?php echo site_url($this->controllerFile.'/edit/'.$row->id);?>" class="btn btn-primary btn-xs" ><span class="glyphicon glyphicon-pencil"></span> </a></td>
					<!--td>
						<?php if($row->status=='Y'){ ?>
							<div id="statusDiv<?php echo $row->id; ?>">
							<a href='javascript: void(0);' onclick='javascript: change_status("<?php echo $row->id; ?>","N");'><?php print active_icon(); ?></a></div>
						<?php }else{ ?>
							<div id="statusDiv<?php echo $row->id; ?>">
							<a href='javascript: void(0)' onclick='javascript: change_status("<?php echo $row->id; ?>","Y");'><?php print inactive_icon(); ?></a></div>
						<?php	} ?>
					</td>
					<td>
						<?php if($row->visibility=='Y'){ ?>
							<div id="visibilityDiv<?php echo $row->id; ?>">
							<a href='javascript: void(0);' onclick='javascript: change_visibility("<?php echo $row->id; ?>","N");'><?php print active_icon(); ?></a></div>
						<?php }else{ ?>
							<div id="visibilityDiv<?php echo $row->id; ?>">
							<a href='javascript: void(0)' onclick='javascript: change_visibility("<?php echo $row->id; ?>","Y");'><?php print inactive_icon(); ?></a></div>
						<?php	} ?>
					</td-->			
                </tr>
               <?php } ?>  
                
              </tbody>
            </table>
           
            </div>
		
		<?php echo $paginator; ?>			
    <?php } ?>
    </form>        
            
                                   
			</div>
        </div><!-- mainpanel -->
    </div><!-- mainwrapper -->
</section>


        
        
        

        
<script language="javascript">
function Check(chk)
{
	//document.frmSearch.product_id
	if(document.frmSearch.Check_All.value=="Check All"){
		for (i = 0; i < chk.length; i++)
		chk[i].checked = true ;
		document.frmSearch.Check_All.value="UnCheck All";
	}else{
		for (i = 0; i < chk.length; i++)
		chk[i].checked = false ;
		document.frmSearch.Check_All.value="Check All";
	}
}
function addSelected(){
	/*var checkedValue = document.querySelector('.product_id:checked').value;
	alert(checkedValue);*/
	var selected = new Array();
	$("input:checkbox[name=product_id]:checked").each(function(){
		selected.push($(this).val());
	});
	//$(selected).serializeArray()
	//alert(selected);
	$.post('<?php echo base_url().$this->controllerFile; ?>/addSelectedProduct', 'selected='+selected, function(data){
		if(data) 
		{
			alert(data);
			//location.reload();
		}
	});	
}
function hdnSort(name, type)
{
	//alert(name);
	document.frmSearch.hdnOrderByFld.value = name;
	if(type == 'ASC')
		document.frmSearch.hdnOrderBy.value = 'DESC';
	else
		document.frmSearch.hdnOrderBy.value = 'ASC';
	document.frmSearch.submit();
}
function change_status(id, val)
{	
	$('#statusDiv'+id).html('<img src="<?php echo base_url(); ?>images/admin/loading.gif" alt=""/>');
	$.post('<?php echo base_url().$this->controllerFile; ?>/change_is_active', 'id='+id+'&val='+val, function(data){
		if(data) 
		{
			if(val == 'Y')
			{
				var val2 = "'N'";
				var text = '<a href="javascript: void(0);" onclick="javascript: change_status('+id+','+val2+');"><?php print active_icon(); ?></a>';
				$('#statusDiv'+id).html(text);
				$("#msgDiv").show("");
				$('#msgDiv').html('Record activated successfully');
				$('#msgDiv').delay(5000).fadeOut('slow', function() {});
				
			}
			else
			{
				var val2 = "'Y'";
				var text = '<a href="javascript: void(0);" onclick="javascript: change_status('+id+','+val2+');"><?php print inactive_icon(); ?></a>';
				$('#statusDiv'+id).html(text);
				$("#msgDiv").show("");
				$('#msgDiv').html('Record inactivated successfully');
				$('#msgDiv').delay(5000).fadeOut('slow', function() {});
				
			}
		}
	});
}
function change_visibility(id, val)
{	
	$('#visibilityDiv'+id).html('<img src="<?php echo base_url(); ?>images/admin/loading.gif" alt=""/>');
	$.post('<?php echo base_url().$this->controllerFile; ?>/change_visibility', 'id='+id+'&val='+val, function(data){
		if(data) 
		{
			if(val == 'Y')
			{
				var val2 = "'N'";
				var text = '<a href="javascript: void(0);" onclick="javascript: change_visibility('+id+','+val2+');"><?php print active_icon(); ?></a>';
				$('#visibilityDiv'+id).html(text);
				$("#msgDiv").show("");
				$('#msgDiv').html('Record updated successfully');
				$('#msgDiv').delay(5000).fadeOut('slow', function() {});
				
			}
			else
			{
				var val2 = "'Y'";
				var text = '<a href="javascript: void(0);" onclick="javascript: change_visibility('+id+','+val2+');"><?php print inactive_icon(); ?></a>';
				$('#visibilityDiv'+id).html(text);
				$("#msgDiv").show("");
				$('#msgDiv').html('Record updated successfully');
				$('#msgDiv').delay(5000).fadeOut('slow', function() {});
				
			}
		}
	});
}
function edit(id){
	//alert(id);
	//window.location="http://stackoverflow.com";
	window.location="<?php echo site_url($this->controllerFile.'edit');?>"+'/'+id;
}
</script>
<?php $this->load->view('footer');?>
		
		
		
		
		
		
		